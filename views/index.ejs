<%- include("partials/head.ejs") %>
<% let actionRoute = sign ? "/user/signin" : "/user/signup" %> 
 
    <% if (loggedIn) { %>
        <%- include("partials/header.ejs") %>  
    <% } %>    

        <main class ="home">
            <% if (!loggedIn) {%>
                <div class="logoFake">
                </div>
                <div class="welcomeContainer">
                    <div class="logoWelcome">
                    </div>
                    <form class="formUser" action="<%=actionRoute%>" method="POST">
                        
                            <input id="email" type="email" placeholder="Email" name="email" required>
                            <% if (!sign) { %>
                                <input id="src" type="text" placeholder="Foto" name="src" required>
                                <input type="text" name="name" placeholder="Nombre y apellido" required>
                                <input type="number" name="phone" placeholder="Número de teléfono" required>
                                <input type="text" name="coverSrc" placeholder="Foto de portada" required>
                                <input type="text" name="city" placeholder="Ciudad" required>
                            <% } %>
                            <input id="password" type="password" placeholder="Contraseña" name="password" required>
                            <input class=<%= !sign ? "registration" : "entration" %> type="submit" value=<%= !sign ? 'Registrarse' : 'Entrar' %>>
                            <div class='messageError'>
                                <% if(error && sign){%>
                                    <p><%= error.includes('incorrecta') ? error : 'Problemas técnicos. Intente mas tarde'%></p> 
                                <% }else if (error && !sign) { %> 
                                    <p><%= error.includes('uso') ? error : 'Problemas técnicos. Intente mas tarde'%></p>
                                <% } %>
                            </div>
                        <% if (!sign) { %>
                            <p style="font-weight: bold;">¿Ya tenés cuenta?. <a class="linkAccount" href="/signin">Entrá acá!</a></p>
                        <% }else { %>
                            <p style="font-weight: bold;">¿No tenés cuenta?. <a class="linkAccount" href="/signup">Entrá acá!</a></p>
                            <% } %>
                    </form>
                    
                </div>
                
            <% }else { %>
                
                    <div id="formUpload">
                        <form action="/image/<%=userId%>" method="POST" enctype="multipart/form-data">
                            <textarea name="comment" placeholder="¿Qué estás pensando?"  required></textarea>
                            <div>
                                <span class="publicationLabel"><label for="inputFile" class="inputLabel"><i class="far fa-images"></i> Fotos </label></span>
                                <input id="inputFile"  type="file" name="image" placeholder="Foto de post" required>
                                <input class="publication" type="submit"  value="Publicar">
                            </div>
                        </form>
                    </div>
                
                    <% comments.forEach((comment, index) => { %>
                        
                        <% if (!info) { %>
                            <div id="postUpload">
                                <div class="userContainer">
                                    <div class="userData">
                                        <a href="/user/data/<%= comment["user.id"] %>"><div class="photoUser" style="background-image: url(<%=comment["user.src"]%>);"></div></a>
                                        <a class="nameUser" href="/user/data/<%= comment["user.id"] %>"><p><%=comment["user.name"]%><span class="check"><i class="fas fa-check-circle"></i></span></p></a>
                                    </div>
                                    <% if  (userId === comment.userId) { %>  
                                        <div class="userAction">
                                            <a href="#windowAdd"><i class="fas fa-trash"></i></a>
                                            <a href="/image/edit/<%=comment.id%>"><i class="fas fa-edit"></i></a>
                                        </div>
                                    <% } %>
                                </div>
                                
                                <div class="commentContainer">
                                    <p><%= comment.comment %></p>
                                </div>
                                <div class="photo" style="background-image: url(/upload/<%=comment.image%>)"></div>
                                    <p><%=date[index]%></p>
                            </div>  
                            

                            <div id="windowAdd" class="modal">
                                <div class="windowPopUpDelete">
                                    <a href="#" style='text-decoration:none;'>
                                        <i class="fas fa-window-close"></i>
                                    </a>
                                    <h3>¿Seguro desea eliminar?</h3>
                                    <div class="confirmDelete">
                                        <a href="/"><i class="fas fa-times"></i></a> 
                                        <a  href="/image/delete/<%=comment.id%>"><i class="fas fa-check"></i></a>
                                    </div>
                                </div>  
                            </div>
                        <% }else{ %>   
                            <h4>¿Seguro quiere editar?<h6>(solo podrá editar el comentario)</h6></h4>
                            <div class="confirmEdit">
                                <a href="/"><i class="fas fa-times"></i></a> 
                                <a  href="#windowAdd"><i class="fas fa-check"></i></a>
                            </div>
                            <div id="windowAdd" class="modal">     
                                <div class="windowPopUpUpdate">
                                    <a href="/" style='text-decoration:none;'>
                                        <i class="fas fa-window-close"></i>
                                    </a>
                                    <div id="formUpdate">
                                        <form action="/image/update/<%=info.id%>" method="POST" enctype="multipart/form-data">
                                            <textarea name="comment" placeholder="¿Qué estás pensando?" ><%=info.comment%></textarea>
                                            <input class="publication" type="submit"  value="Aceptar">
                                        </form>
                                    </div>
                                    <div class="photoFound" style="background-image: url(/upload/<%=info.image%>)"></div>
                                </div>  
                            </div>      
                        <% } %>
                             
                        
                        
                    <% }) %>
                <% } %>
        </main>
    
    
        <script src="https://kit.fontawesome.com/f119dc4da4.js" crossorigin="anonymous"></script>   
</body>
</html>